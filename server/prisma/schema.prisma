generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma/client"
}

datasource db {
  provider = "sqlite"
  url      = "file:../data/budget.sqlite"
}

model Transaction {
  id            String   @id @default(uuid())
  bank          String
  accountIban   String?
  dateOperation DateTime
  dateValeur    DateTime?
  label         String
  details       String?
  debit         Float    @default(0)
  credit        Float    @default(0)
  amount        Float
  yearMonth     String
  sourceFile    String
  categoryId    String?
  fingerprint   String   @unique
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  typeOperation String?
  entityId      String?
  entity        Entity?  @relation(fields: [entityId], references: [id])
}

model Category {
  id          String   @id @default(uuid())
  name        String   @unique
  color       String?
  icon        String?
  description String?
    // ðŸ”¹ Relation hiÃ©rarchique auto-rÃ©fÃ©rente
  parentCategoryId String?     
  parent           Category?   @relation("SubCategories", fields: [parentCategoryId], references: [id])
  children         Category[]  @relation("SubCategories")

  // ðŸ”¹ Relations externes
  entities    Entity[]
}

model Tag {
  id        String      @id @default(uuid())
  name      String      @unique
  color     String?
  entities  EntityTag[]
}

model Entity {
  id           String        @id @default(uuid())
  name         String        @unique
  aliasOfId    String?
  aliasOf      Entity?       @relation("AliasRelation", fields: [aliasOfId], references: [id])
  aliases      Entity[]      @relation("AliasRelation")
  categoryId   String?
  category     Category?     @relation(fields: [categoryId], references: [id])
  tags         EntityTag[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  transactions Transaction[]
}

model EntityTag {
  entityId String
  tagId    String
  entity   Entity @relation(fields: [entityId], references: [id])
  tag      Tag    @relation(fields: [tagId], references: [id])

  @@id([entityId, tagId]) // clÃ© primaire composite
}
